mapscripts BlankMap_MapScripts {
    MAP_SCRIPT_ON_TRANSITION {
        if (var(VAR_AKIHIKOS_INTRO_STATE) > 0) {
            setflag(FLAG_SPAWN_INVISIBLE)
        }
        if (var(VAR_MITSURU_RELATIONSHIP_POINTS) == 0){
           setflag(FLAG_SPAWN_INVISIBLE)
           playbgm(MUS_END, TRUE) 
        }
    }
    MAP_SCRIPT_ON_FRAME_TABLE [
        VAR_AKIHIKOS_INTRO_STATE, 7: SunshineWoods_Eventscript_WarpBackToOrphanage
        VAR_AKIHIKOS_INTRO_STATE, 9: SunshineOrphanageMainHall_Eventscript_WarpBackToAkihikosRoom
        VAR_AKIHIKOS_INTRO_STATE, 13: SunshineTown_PokemonCenter_Eventscript_Onframe13
        VAR_AKIHIKOS_INTRO_STATE, 19: SunshineOrphanage_Burning_Eventscript_OnFrame19
        VAR_AKIHIKOS_INTRO_STATE, 20: SunshineTownRiverbank_Eventscript_OnFrame20
        VAR_AKIHIKOS_INTRO_STATE, 22: SunshineTownRiverbank_Eventscript_OnFrame22
        VAR_AKIHIKOS_INTRO_STATE, 24: Route2_Eventscript_AkihikoOnFrame24
        VAR_AKIHIKOS_INTRO_STATE, 26: Route2_Eventscript_AkihikoOnFrame26
        VAR_AKIHIKOS_INTRO_STATE, 28: Route2_House_Eventscript_AkihikoOnFrame28
        VAR_AKIHIKOS_INTRO_STATE, 31: Route2_House_Eventscript_AkihikoOnFrame31
        VAR_AKIHIKOS_INTRO_STATE, 34: SunshineMeadow_Eventscript_AkihikoOnFrame34
        VAR_AKIHIKOS_INTRO_STATE, 36: SunshineMeadow_Eventscript_AkihikoOnFrame36
        VAR_AKIHIKOS_INTRO_STATE, 38: Route2_HouseToBlankMap_Eventscript_AkihikoOnFrame38
        VAR_AKIHIKOS_INTRO_STATE, 42: Route2_Eventscript_AkihikoOnFrame42
        ]
}


script SunshineWoods_Eventscript_WarpBackToOrphanage {
    lock
    msgbox(format("{DESTROY_MUGSHOT} Akihiko picked up the Pawmi and hurried back to the orphanage."))
    closemessage
    fadescreenswapbuffers(FADE_TO_BLACK,0)
    warp(MAP_SUNSHINE_ORPHANAGE_MAIN_HALL, 12, 22)
    clearflag(FLAG_SPAWN_INVISIBLE)
    release
}

script SunshineOrphanageMainHall_Eventscript_WarpBackToAkihikosRoom {
    lockall
    warpsilent(MAP_SUNSHINE_ORPHANAGE_AKIHIKOS_ROOM2F, 3, 7)
    clearflag(FLAG_SPAWN_INVISIBLE)
    releaseall
}

script SunshineTown_PokemonCenter_Eventscript_Onframe13 {
    lock
    msgbox("10 minutes later...")
    closemessage
    setvar(VAR_AKIHIKOS_INTRO_STATE, 14)
    warpsilent(MAP_SUNSHINE_TOWN_POKEMON_CENTER, 11, 8)
    clearflag(FLAG_SPAWN_INVISIBLE)
    release
}

script SunshineOrphanage_Burning_Eventscript_OnFrame19 {
    lock
    delay(30)
    warpsilent(MAP_SUNSHINE_TOWN_RIVERBANK, 13, 5)
    clearflag(FLAG_SPAWN_INVISIBLE)
    release
}

script SunshineTownRiverbank_Eventscript_OnFrame20 {
    lock
    delay(30)
    setvar(VAR_AKIHIKOS_INTRO_STATE, 21)
    warpsilent(MAP_SUNSHINE_TOWN_RIVERBANK, 13, 0)
    clearflag(FLAG_SPAWN_INVISIBLE)
}

script SunshineTownRiverbank_Eventscript_OnFrame22 {
    msgbox("A few days later.")
    closemessage
    setvar(VAR_AKIHIKOS_INTRO_STATE, 23)
    warpsilent(MAP_SUNSHINE_TOWN_KUROSAWAS_HOUSE, 4, 4)
    clearflag(FLAG_SPAWN_INVISIBLE)
    
}

script Route2_Eventscript_AkihikoOnFrame24 {
    lock
    warpsilent(MAP_ROUTE2, 35, 11)
    setvar(VAR_AKIHIKOS_INTRO_STATE, 25)
    release
}

script Route2_Eventscript_AkihikoOnFrame26 {
    setvar(VAR_AKIHIKOS_INTRO_STATE, 27)
    warpsilent(MAP_ROUTE2_HOUSE, 5, 3)
    clearflag(FLAG_SPAWN_INVISIBLE)
}

script Route2_House_Eventscript_AkihikoOnFrame28 {
    setvar(VAR_AKIHIKOS_INTRO_STATE, 29)
    warpsilent(MAP_ROUTE2_HOUSE, 4, 7)
    clearflag(FLAG_SPAWN_INVISIBLE)
}

script Route2_House_Eventscript_AkihikoOnFrame31 {
    setvar(VAR_AKIHIKOS_INTRO_STATE, 32)
    warpsilent(MAP_ROUTE2_HOUSE, 4, 7)
    clearflag(FLAG_SPAWN_INVISIBLE)
}

script SunshineMeadow_Eventscript_AkihikoOnFrame34 {
    setvar(VAR_AKIHIKOS_INTRO_STATE, 35)
    warpsilent(MAP_SUNSHINE_MEADOW, 10, 8)
}

script SunshineMeadow_Eventscript_AkihikoOnFrame36 {
    setvar(VAR_AKIHIKOS_INTRO_STATE, 37)
    if (var(VAR_MITSURU_RELATIONSHIP_POINTS) == 0){//GAME OVER
        msgbox(format("Shinjiro didn't stand a slightest chance and was completely wiped out by Mitsuru."))
    }
    else{
        msgbox(format("Shinjiro managed to knock out one of Mitsuru's Pok√©mon before getting wiped out by her Vulpix."))
    }
    warpsilent(MAP_SUNSHINE_MEADOW, 10, 11)
}

script Route2_HouseToBlankMap_Eventscript_AkihikoOnFrame38 {
    if (var(VAR_MITSURU_RELATIONSHIP_POINTS) == 0){
        goto(SunshineMeadow_Eventscript_GameOver)
        end
    }
    setvar(VAR_AKIHIKOS_INTRO_STATE, 39)
    fwdtime(22, 30)
    msgbox(format("Later that night..."))
    closemessage
    warpsilent(MAP_ROUTE2_HOUSE, 3, 11)
}

script Route2_Eventscript_AkihikoOnFrame42 {
    setvar(VAR_AKIHIKOS_INTRO_STATE, 43)
    fwdtime(6,20)
    fwdweekday(WEEKDAY_MON)
    msgbox(format("The next morning..."))
    closemessage
    warpsilent(MAP_ROUTE2_HOUSE, 3, 11)
}

script SunshineMeadow_Eventscript_GameOver {
    lock
    msgbox(format("Mitsuru Kirijo walked away without turning back.\p
    Her Vulpix trotted along her lonesome yet determined silhouette.\p
    The Inteleon gave you one last disappointed look before trailing behind its two companions."))
    closemessage
    delay(30)
    msgbox(format("You and Shinjiro continued your search for Miki to no avail.\p
    Not long after, both of you ended up getting captured by the men in black and suffered endless nightmares.\p
    Only darkness awaits..."))
    closemessage
    setflag(FLAG_DONT_TRANSITION_MUSIC)
    warpsilent(MAP_GAME_OVER, 0, 5)
    waitstate
    release
    end
}